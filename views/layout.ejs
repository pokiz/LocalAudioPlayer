<!DOCTYPE html>  
<html lang="en">  
  <head>
    <meta charset="utf-8">
    <title>Pivotal Search</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="/static//js/jquery.min.js"></script>
    <script type="text/javascript" src="/static//js/bootstrap.min.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- styles -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href='/static/css/layout.css' rel="stylesheet">

  </head>
  <body>
    <%- body %>
    <script type="text/javascript">
        var socket = io.connect();
        var routines = setInterval(function() {
          if ($(".now-playing-remaining"))
          {
            var now = new Date().getTime();
            var remaining = parseInt((parseInt($(".now-playing-remaining").attr("data-end-timestamp")) - now) / 1000);
            var hours = Math.floor(remaining / 3600),
                minutes = Math.floor((remaining / 60) % 60),
                seconds = Math.floor(remaining % 60);
            var text = "";
            if (hours)
              text+= hours + "h ";
            if (minutes)
              text+= minutes + "m ";
            if (seconds)
              text+= seconds + "s ";
            text+= "remaining"
            $(".now-playing-remaining").text(text);
          }
        }, 1000);

        socket.on('connection', function () {
          console.log("New user connected");
        });
        socket.on('up', function (data) {
          var url = getRootUrl();
          window.location.href = url;
        });
        socket.on('add', function (data) {
          var url = getRootUrl();
          window.location.href = url;
        });
        socket.on('remove', function (data) {
          var url = getRootUrl();
          window.location.href = url;
        });
        socket.on('now-playing', function (data) {
          var url = getRootUrl();
          window.location.href = url;
        });
        socket.on('user join', function (data) {
          $(".users-count").html(data.count);
        });
        socket.on('user left', function (data) {
          $(".users-count").html(data.count);
        });
      function getRootUrl() {
        return window.location.origin?window.location.origin+'/':window.location.protocol+'/'+window.location.host+'/';
      }

    </script>
  </body>
</html>  